{% extends "customerapp/base.html" %}
{% load static %}

{% block title %}Wardrobe{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-[calc(100vh-70px)] p-5">
    <div class="bg-white rounded-lg shadow-md p-6 max-w-7xl mx-auto min-h-[300px]">
        <!-- Header -->
        <div class="flex justify-between items-center border-b border-gray-200 pb-4 mb-6">
            <h1 class="text-2xl font-semibold text-[#8E793E] flex items-center gap-2">
                <i class="fas fa-boxes"></i> PRODUCTS
            </h1>
        </div>

        <!-- Filter Row -->
        <div class="flex flex-wrap gap-4 mb-6 items-center">
            <!-- Category Filter -->
            <div class="flex-1 min-w-[180px]">
                <select id="category" name="category" onchange="filterInventory()" 
                    class="w-full p-2 border border-[#AD974F] rounded-md bg-white appearance-none bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzhlNzkzZSI+PHBhdGggZD0iTTcgMTBsNSA1IDUtNXoiLz48L3N2Zz4=')] bg-no-repeat bg-[right_10px_center] bg-[length:16px_16px]">
                    <option value="">All Categories</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if selected_category == category.id|stringformat:"s" %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Color Filter -->
            <div class="flex-1 min-w-[180px]">
                <select id="color" name="color" onchange="filterInventory()" 
                    class="w-full p-2 border border-[#AD974F] rounded-md bg-white appearance-none bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzhlNzkzZSI+PHBhdGggZD0iTTcgMTBsNSA1IDUtNXoiLz48L3N2Zz4=')] bg-no-repeat bg-[right_10px_center] bg-[length:16px_16px]">
                    <option value="">All Colors</option>
                    {% for color in colors %}
                        <option value="{{ color.id }}" {% if selected_color == color.id|stringformat:"s" %}selected{% endif %}>
                            {{ color.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Size Filter -->
            <div class="flex-1 min-w-[180px]">
                <select id="size" name="size" onchange="filterInventory()" 
                    class="w-full p-2 border border-[#AD974F] rounded-md bg-white appearance-none bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzhlNzkzZSI+PHBhdGggZD0iTTcgMTBsNSA1IDUtNXoiLz48L3N2Zz4=')] bg-no-repeat bg-[right_10px_center] bg-[length:16px_16px]">
                    <option value="">All Sizes</option>
                    {% for size in sizes %}
                        <option value="{{ size.id }}" {% if selected_size == size.id|stringformat:"s" %}selected{% endif %}>
                            {{ size.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Sort Filter -->
            <div class="flex-1 min-w-[180px]">
                <select id="sort" name="sort" onchange="filterInventory()" 
                    class="w-full p-2 border border-[#AD974F] rounded-md bg-white appearance-none bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzhlNzkzZSI+PHBhdGggZD0iTTcgMTBsNSA1IDUtNXoiLz48L3N2Zz4=')] bg-no-repeat bg-[right_10px_center] bg-[length:16px_16px]">
                    <option value="">Default Sorting</option>
                    <option value="name_asc">Name (A-Z)</option>
                    <option value="name_desc">Name (Z-A)</option>
                    <option value="price_asc">Price (Low to High)</option>
                    <option value="price_desc">Price (High to Low)</option>
                </select>
            </div>

            <!-- Clear Filters Button -->
            <button onclick="clearFilters()" 
                class="p-2 bg-gray-50 border border-[#AD974F] rounded-md flex items-center gap-2 cursor-pointer transition-all hover:bg-red-50 hover:text-red-700 hover:border-red-500">
                <i class="fas fa-times"></i> Clear Filters
            </button>
        </div>

        <!-- Inventory Items Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5">
            {% if inventory_items %}
                {% for item in inventory_items %}
                <div class="bg-white rounded-lg overflow-hidden shadow-md transition-all hover:-translate-y-1 hover:shadow-lg relative border border-gray-200 flex flex-col h-[28rem]">
                    <!-- Status Badge -->
                    <div class="absolute top-2 right-2 px-3 py-1 rounded-full text-xs font-semibold text-white {% if item.available %}bg-green-500{% else %}bg-red-500{% endif %}">
                        {{ item.available|yesno:"In Stock,Out of Stock" }}
                    </div>
                    
                    <!-- Item Image -->
                    <div class="h-[270px] overflow-hidden">
                        {% if item.image %}
                            <img src="{{ item.image.url }}" alt="{{ item.name }}" class="w-full h-full object-cover transition-transform hover:scale-105">
                        {% else %}
                            <img src="{% static 'image/default-placeholder.png' %}" alt="No image" class="w-full h-full object-cover">
                        {% endif %}
                    </div>
                    
                    <!-- Item Info -->
                    <div class="p-3 flex-grow flex flex-col">
                        <h3 class="text-base font-medium text-gray-900 mb-1 line-clamp-1">{{ item.name }}</h3>
                        <div class="flex flex-wrap gap-1 mb-2 text-xs text-gray-600">
                            <span class="flex items-center gap-1">
                                <i class="fas fa-tag"></i> {{ item.category.name }}
                            </span>
                            <span class="flex items-center gap-1">
                                <i class="fas fa-palette"></i> {{ item.color.name|default:"N/A" }}
                            </span>
                            <span class="flex items-center gap-1">
                                <i class="fas fa-ruler"></i> {{ item.size.name|default:"N/A" }}
                            </span>
                        </div>
                        <div class="flex items-center gap-1 text-xs text-gray-600 mb-2">
                            <i class="fas fa-box-open"></i> {{ item.quantity }} available
                        </div>
                
                        <!-- View Button -->
                        <a href="{% url 'customerapp:item_detail' item.id %}" 
                            class="mt-auto block p-2 bg-[#8E793E] text-white text-center rounded-md transition-colors hover:bg-[#AD974F] text-sm">
                            <i class="fas fa-eye"></i> View Details
                        </a>
                    </div>
                </div>
                
                
                {% endfor %}
            {% else %}
                <!-- No Items Found -->
                <div class="col-span-full text-center p-10 bg-white rounded-lg shadow-md border border-gray-200">
                    <i class="fas fa-search text-4xl text-[#8E793E] mb-4"></i>
                    <p class="text-gray-600 mb-5">No items match your filters</p>
                    <button onclick="clearFilters()" 
                        class="px-4 py-2 bg-[#8E793E] text-white rounded-md border-none cursor-pointer transition-colors hover:bg-[#AD974F]">
                        Clear Filters
                    </button>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function filterInventory() {
        const category = document.getElementById('category').value;
        const color = document.getElementById('color').value;
        const size = document.getElementById('size').value;
        const sort = document.getElementById('sort').value;
        
        let url = "{% url 'customerapp:wardrobe' %}?";
        if (category) url += `category=${category}&`;
        if (color) url += `color=${color}&`;
        if (size) url += `size=${size}&`;
        if (sort) url += `sort=${sort}`;
        
        window.location.href = url;
    }

    function clearFilters() {
        document.getElementById('category').value = '';
        document.getElementById('color').value = '';
        document.getElementById('size').value = '';
        document.getElementById('sort').value = '';
        filterInventory();
    }
</script>
{% endblock %}