{% extends "customerapp/base.html" %}
{% load static %}

{% block title %}Inventory{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/inventory.css' %}">
{% endblock %}

{% block content %}
    <h1 class="inventory-title">Inventory</h1>

    <div class="controls-container">
        <div class="filter-category">
            <label for="category">Filter by Category:</label>
            <select id="category" name="category" onchange="filterInventory()">
                <option value="">All</option>
                {% for category in categories %}
                    <option value="{{ category.id }}" {% if selected_category == category.id|stringformat:"s" %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="filter-color">
            <label for="color">Filter by Color:</label>
            <select id="color" name="color" onchange="filterInventory()">
                <option value="">All</option>
                {% for color in colors %}
                    <option value="{{ color.id }}" {% if selected_color == color.id|stringformat:"s" %}selected{% endif %}>
                        {{ color.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="filter-size">
            <label for="size">Filter by Size:</label>
            <select id="size" name="size" onchange="filterInventory()">
                <option value="">All</option>
                {% for size in sizes %}
                    <option value="{{ size.id }}" {% if selected_size == size.id|stringformat:"s" %}selected{% endif %}>
                        {{ size.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="sort-by">
            <label for="sort">Sort by:</label>
            <select id="sort" name="sort" onchange="filterInventory()">
                <option value="">Default</option>
                <option value="name_asc" {% if sort == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
                <option value="name_desc" {% if sort == 'name_desc' %}selected{% endif %}>Name (Z-A)</option>
                <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>Price (Low to High)</option>
                <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>Price (High to Low)</option>
            </select>
        </div>

        <div>
            <button type="button" onclick="clearFilters()" class="">Clear Filters</button>
        </div>
    </div>

    <div class="inventory-container">
        {% if inventory_items %}
            {% for item in inventory_items %}
                <div class="inventory-card">
                    {% if item.image %}
                        <img src="{{ item.image.url }}" alt="{{ item.name }}">
                    {% else %}
                        <img src="{% static 'image/default-placeholder.png' %}" alt="No image available">
                    {% endif %}
                    <h3>{{ item.name }}</h3>
                    <p><strong>Category:</strong> {{ item.category.name }}</p>
                    <p><strong>Color:</strong> {{ item.color.name|default:"N/A" }}</p>
                    <p><strong>Size:</strong> {{ item.size.name|default:"N/A" }}</p>
                    <p><strong>Quantity:</strong> {{ item.quantity }}</p>
                    <p><strong>Price:</strong> â‚±{{ item.purchase_price }}</p>
                    <p><strong>Available:</strong> {{ item.available|yesno:"Yes,No" }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p>No inventory items found matching the selected criteria.</p>
        {% endif %}
    </div>

    <script>
        function filterInventory() {
            const selectedCategory = document.getElementById("category").value;
            const selectedColor = document.getElementById("color").value;
            const selectedSize = document.getElementById("size").value;
            const selectedSort = document.getElementById("sort").value;

            let url = "{% url 'customerapp:wardrobe' %}?"  // Updated for customerapp

            if (selectedCategory) url += "category=" + encodeURIComponent(selectedCategory) + "&";
            if (selectedColor) url += "color=" + encodeURIComponent(selectedColor) + "&";
            if (selectedSize) url += "size=" + encodeURIComponent(selectedSize) + "&";
            if (selectedSort) url += "sort=" + encodeURIComponent(selectedSort);

            window.location.href = url;
        }

        function clearFilters() {
            document.getElementById("category").value = "";
            document.getElementById("color").value = "";
            document.getElementById("size").value = "";
            document.getElementById("sort").value = "";

            filterInventory(); // Reuse the existing filter logic to refresh the page
        }
    </script>
{% endblock %}
