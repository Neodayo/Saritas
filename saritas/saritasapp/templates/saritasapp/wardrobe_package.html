{% extends 'saritasapp/base.html' %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center">Wardrobe Package Selection</h2>
    
    <form method="post" id="wardrobeForm">
        {% csrf_token %}
        
        <!-- Display Package Information -->
        <div class="card mb-3 p-3">
            <h4>{{ package.name }} - {{ package.get_tier_display }}</h4>
            <p><strong>Base Price:</strong> ₱{{ package.base_price }}</p>
            <p><strong>Refundable Deposit:</strong> ₱{{ package.refundable_deposit }}</p>
        </div>

        <div class="row">
            {% for category, items in inventory.items %}
                <div class="col-md-6">
                    <h4 class="border-bottom pb-2">{{ category }}</h4>
                    {% for item in items %}
                        <div class="form-check">
                            <input class="form-check-input wardrobe-item" type="checkbox"
                                   name="wardrobe_items" value="{{ item.id }}" data-price="{{ item.rental_price }}" checked>
                            <label class="form-check-label">{{ item.name }} (₱{{ item.rental_price }})</label>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>

        <hr>

        <!-- Total Price Calculation -->
        <div class="card p-3">
            <h4>Total Price: ₱<span id="totalPrice">0.00</span></h4>
        </div>

        <button type="submit" class="btn btn-primary mt-3">Submit</button>
    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const checkboxes = document.querySelectorAll(".wardrobe-item");
    const totalPriceElement = document.getElementById("totalPrice");
    const basePrice = parseFloat("{{ package.base_price }}");
    const refundableDeposit = parseFloat("{{ package.refundable_deposit }}");

    function updateTotalPrice() {
        let total = basePrice + refundableDeposit;
        checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                total += parseFloat(checkbox.dataset.price);
            }
        });
        totalPriceElement.textContent = total.toFixed(2);
    }

    checkboxes.forEach(checkbox => {
        checkbox.addEventListener("change", updateTotalPrice);
    });

    // Initialize total price on page load
    updateTotalPrice();
});
</script>

{% endblock %}
