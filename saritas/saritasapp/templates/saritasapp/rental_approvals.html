{% extends "saritasapp/base.html" %}
{% load static %}

{% block title %}Rental Approvals | Sarita's{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/rental_approvals.css' %}">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="approvals-container bg-gradient-to-br from-[#fffaf3] to-[#fcf8f0] min-h-screen py-8 px-4 sm:px-6 lg:px-8 rounded-2xl shadow-lg border border-[#f4e9d8]">

    <!-- Header Section -->
    <div class="mb-8 text-center">
        <h1 class="gold-heading text-4xl sm:text-5xl font-bold mb-2">Rental Approvals</h1>
        <h2 class="sub-heading text-xl sm:text-2xl text-[#AD974F]">Pending Rental Requests</h2>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div class="stat-card bg-white p-6 rounded-xl shadow-lg border border-[#f4e9d8]">
            <div class="stat-label text-[#8E793E] text-sm font-semibold uppercase">Pending</div>
            <div class="stat-value text-3xl font-bold text-[#6B5B3A]">{{ stats.pending }}</div>
        </div>
        <div class="stat-card bg-white p-6 rounded-xl shadow-lg border border-[#f4e9d8]">
            <div class="stat-label text-[#8E793E] text-sm font-semibold uppercase">Approved</div>
            <div class="stat-value text-3xl font-bold text-[#6B5B3A]">{{ stats.approved }}</div>
        </div>
        <div class="stat-card bg-white p-6 rounded-xl shadow-lg border border-[#f4e9d8]">
            <div class="stat-label text-[#8E793E] text-sm font-semibold uppercase">Rejected</div>
            <div class="stat-value text-3xl font-bold text-[#6B5B3A]">{{ stats.rejected }}</div>
        </div>
    </div>

    <!-- DataTable -->
    <div class="bg-white rounded-xl shadow-lg border border-[#f4e9d8] overflow-x-auto">
        <table id="approvalsTable" class="w-full">
            <thead class="bg-gradient-to-r from-[#8E793E] to-[#6B5B3A] text-white">
                <tr>
                    <th class="px-6 py-4 text-left font-semibold">Request ID</th>
                    <th class="px-6 py-4 text-left font-semibold">Customer</th>
                    <th class="px-6 py-4 text-left font-semibold">Item</th>
                    <th class="px-6 py-4 text-left font-semibold">Dates</th>
                    <th class="px-6 py-4 text-center font-semibold">Days</th>
                    <th class="px-6 py-4 text-right font-semibold">Total</th>
                    <th class="px-6 py-4 text-center font-semibold">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-[#f4e9d8]">
                {% for rental in pending_rentals %}
                <tr class="hover:bg-[#fcfaf6] transition-colors">
                    <td class="px-6 py-4 text-[#5a4b32]">#{{ rental.id }}</td>
                    <td class="px-6 py-4 text-[#5a4b32]">{{ rental.customer.user.get_full_name }}</td>
                    <td class="px-6 py-4 text-[#5a4b32]">{{ rental.inventory.name }}</td>
                    <td class="px-6 py-4 text-[#5a4b32]">
                        {{ rental.rental_start|date:"M d" }} - {{ rental.rental_end|date:"M d, Y" }}
                    </td>
                    <td class="px-6 py-4 text-center text-[#5a4b32]">{{ rental.duration_days }}</td>
                    <td class="px-6 py-4 text-right text-[#5a4b32]">â‚±{{ rental.total_cost|floatformat:2 }}</td>
                    <td class="px-6 py-4 text-center">
                        <div class="flex justify-center space-x-2">
                            <a href="{% url 'saritasapp:approve_rental' rental.id 'approve' %}" class="action-btn bg-green-600 hover:bg-green-700">
                                <i class="fas fa-check mr-2"></i>Approve
                            </a>
                            <a href="{% url 'saritasapp:approve_rental' rental.id 'reject' %}" class="action-btn bg-red-600 hover:bg-red-700">
                                <i class="fas fa-times mr-2"></i>Reject
                            </a>
                            <a href="{% url 'saritasapp:rental_detail' rental.id %}" class="action-btn bg-[#8E793E] hover:bg-[#6B5B3A]">
                                <i class="fas fa-eye mr-2"></i>View
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="px-6 py-8 text-center">
                        <div class="empty-state">
                            <i class="fas fa-check-circle text-4xl text-[#AD974F] mb-4"></i>
                            <h4 class="text-xl font-semibold text-[#8E793E] mb-2">No pending approvals</h4>
                            <p class="text-[#AD974F]">All rental requests have been processed</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<!-- <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script> -->
<script>
$(document).ready(function() {
    $('#approvalsTable').DataTable({
        responsive: true,
        scrollX: true,
        dom: '<"flex flex-col lg:flex-row items-center justify-between mb-4"<"mb-4 lg:mb-0"f><"lg:ml-4"l>>rt<"flex flex-col lg:flex-row items-center justify-between mt-4"<"mb-4 lg:mb-0"i><"lg:ml-4"p>>',
        language: {
            search: "_INPUT_",
            searchPlaceholder: "Search reservations...",
            lengthMenu: "Show _MENU_ entries",
            info: "Showing _START_ to _END_ of _TOTAL_ entries",
            paginate: {
                previous: '<i class="fas fa-chevron-left"></i>',
                next: '<i class="fas fa-chevron-right"></i>'
            }
        },
        columnDefs: [
            { responsivePriority: 1, targets: 1 },
            { responsivePriority: 2, targets: 6 },
            { orderable: false, targets: 6 }
        ],
        initComplete: function() {
            $('.dataTables_filter input').addClass('border border-[#e6d6b8] rounded-lg px-4 py-2 focus:ring-2 focus:ring-[#8E793E]');
            $('.dataTables_length select').addClass('border border-[#e6d6b8] rounded-lg px-4 py-2 focus:ring-2 focus:ring-[#8E793E]');
        }
    });
});
</script>
{% endblock %}
